---
- hosts: app
  name: "Configure hosts & deploy application"
  tasks:
    -
      become: true
      copy:
        dest: /etc/systemd/system/puma.service
        src: puma.service.j2
      name: "Add unit file for Puma"
      notify: reload puma
    -
      become: true
      name: "enable puma"
      systemd: "name=puma enabled=yes"
    -
      name: "Add config for DB connection"
      template:
        src: db_config.j2
        dest: "/home/{{ deploy_user }}/db_config"
        owner: "{{ deploy_user }}"
        group: "{{ deploy_user }}"

    -
      become: true
      name: "enable puma"
      systemd: "name=puma enabled=yes"
