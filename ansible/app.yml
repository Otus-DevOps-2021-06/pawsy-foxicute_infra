---
-
  become: true
  handlers:
    -
      name: "reload puma"
      systemd: "name=puma state=restarted"
  hosts: app
  name: "Configure App"
  tasks:
    -
      copy:
        dest: /etc/systemd/system/puma.service
        src: files/puma.service
      name: "Add unit file for Puma"
      notify: "reload puma"
    -
      name: "Add config for DB connection"
      template:
        dest: /home/ubuntu/db_config
        group: ubuntu
        owner: ubuntu
        src: templates/db_config.j2
    -
      name: "enable puma"
      systemd: "name=puma enabled=yes"
  vars:
    db_host: "178.154.252.59"
